# 服务器优化

为了同时保证**高自由度**和**流畅不卡顿**的游戏体验，[城镇生存服](/sur)有以下优化措施。

?> 经长期观察，这些优化措施基本不会改变游戏原本的玩法。

## 长期存在的措施

?> 以下措施**始终**存在于[城镇生存服](/sur)。

单位换算：`20 ticks` = `1 秒`

- `刷怪笼`刷出来的所有怪物都是降智过的
  - 意思是他们不带有敌意，也不会寻路
  - 但这些怪物依然会跳跃，也就是说基于流水改造刷怪笼依然有效
- `玩家`射出来的`箭矢`将在`300 ticks`后消失
- `怪物`射出来的`箭矢`将在`60 ticks`后消失
- 如果`1x1`的空间内有超过`2`个实体，则这些实体将不会计算`碰撞体积`
- 不计算`盔甲架`
  - 直接影响是盔甲架不会被环境影响，例如不会被水冲走
- `圆石`和`地狱岩`掉落在地上超过`300 ticks`就会消失。其他所有物品是超过`3000 ticks`才消失
  - 请注意，如果`玩家`离掉落物品太远（`2`格以上），则实际消失的时间要比设定上更长
- 实体`活跃半径`有所调整
  - 解释
    - `活跃半径`指的是一个实体被服务端**持续计算**需要多大半径内有`玩家`存在
    - 如果指定半径内没有玩家存在，那么实体被计算的频率会变低，而不是持续计算
    - 例一：当玩家处在僵尸（怪物）的活跃半径内，僵尸会主动尝试（寻路）冲向玩家
    - 例二：如果发现一个离你较远的生物对你没反应，检查你是否在它的活跃半径内
  - `动物`活跃半径为`8`格
  - `鱼类`活跃半径为`8`格
  - `怪物`活跃半径为`24`格
  - `掠夺者`活跃半径为`48`格
  - `其他实体`活跃半径为`2`格
- 每个`掠夺者`周围可生成的其他掠夺者的最大数量为`4`只
  - 可以防止极短时间内在哨塔附近产生的大量掠夺者导致卡服

## 暂时性介入措施

?>  以下措施**仅仅在服务器负载过高时**才会启用。

> [!tip]
> 建议把高负荷操作（例如树场）放到在线玩家较少时进行，避免触发下列措施使得高负荷操作被迫暂停。

- 措施一：暂停红石电路
  - 运行频率过高的红石电路将在服务器负载过高时被自动暂停运行。
  - 为了保证电路整体性，当一个方块上的红石被检测出频率过高时，其周围`3×3`区块内的所有红石也会被暂停。
  - 被暂停的红石电路不会因此而损坏，也不会被拆除任何部件，只是暂时不工作。
  - 降低频率/等待服务器负载降低都可以让电路恢复运行。
- 措施二：降低生物智商
  - 降智之后的生物不会对周遭事物做出反应，也不会寻路
  - 例如，苦力怕遇到玩家不会爆炸，牛羊不会吃草，鸡不会下蛋
  - 特殊情况：末影人、僵尸猪人、海豚永远不会被降智
- 措施三：降低[方块刻](https://minecraft-zh.gamepedia.com/%E5%88%BB#.E6.96.B9.E5.9D.97.E5.88.BB)
  - 当方块刻被降低后，游戏世界里**关于方块**的随机事件发生频率将会变低，例如植物的生长会变慢等等。

<mark>当服务器负载恢复成较低状态时，将自动解除上面的限制措施。</mark>

## 查看服务器负载

输入`/tps`查看服务器的负载情况。

该指令会呈现一些指标，解释如下：

- `TPS from last 5s, 10s, 1m, 5m, 15m`
  - 显示过去 5s, 10s, 1m, 5m, 15m 的 TPS
  - TPS 是一个 0 到 20 之间的数值
  - 数值越小代表服务器的负载越高，也意味着游戏世界的速度变慢
  - 数值越高代表服务器的负载越低，也意味着游戏世界的速度变快（不会快进，只会趋于正常速度）
- `CPU Usage from last 10s, 1m, 15m`
  - 显示过去 10s, 1m, 15m 的 CPU 负载
  - process 指城镇生存服本身使用的 CPU
  - system 指游戏服务器的总 CPU 负载，这包括城镇生存服和其他子服务器
